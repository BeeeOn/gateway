<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>BeeeOn Gateway: BeeeOn::SafeWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BeeeOn.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">BeeeOn Gateway
   &#160;<span id="projectnumber">v2018.07.1-rc2-46-g9038ede</span>
   </div>
   <div id="projectbrief">Platform to interconnect the IoT world</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>BeeeOn</b></li><li class="navelem"><a class="el" href="classBeeeOn_1_1SafeWriter.html">SafeWriter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">BeeeOn::SafeWriter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classBeeeOn_1_1SafeWriter.html" title="SafeWriter is a helper that allows to perform file writes that are atomic. SafeWriter always rewrites...">SafeWriter</a> is a helper that allows to perform file writes that are atomic. <a class="el" href="classBeeeOn_1_1SafeWriter.html" title="SafeWriter is a helper that allows to perform file writes that are atomic. SafeWriter always rewrites...">SafeWriter</a> always rewrites a whole file. However, it either rewrites that file or it does nothing.  
 <a href="classBeeeOn_1_1SafeWriter.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SafeWriter_8h_source.html">SafeWriter.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for BeeeOn::SafeWriter:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classBeeeOn_1_1SafeWriter.png" usemap="#BeeeOn::SafeWriter_map" alt=""/>
  <map id="BeeeOn::SafeWriter_map" name="BeeeOn::SafeWriter_map">
<area href="classBeeeOn_1_1Loggable.html" alt="BeeeOn::Loggable" shape="rect" coords="0,0,124,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adcd400ae5a6e95c603298cb7d020a4ca"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adcd400ae5a6e95c603298cb7d020a4ca"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>SafeWriter</b> (const Poco::File &amp;tmpFile)</td></tr>
<tr class="separator:adcd400ae5a6e95c603298cb7d020a4ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6c5665aeff1b0fba2fe19beb1be4a20"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af6c5665aeff1b0fba2fe19beb1be4a20"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>SafeWriter</b> (const Poco::File &amp;tmpFile, const std::string &amp;ext)</td></tr>
<tr class="separator:af6c5665aeff1b0fba2fe19beb1be4a20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8641c333b17b23422680a170900207c7"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SafeWriter.html#a8641c333b17b23422680a170900207c7">stream</a> (bool force=false)</td></tr>
<tr class="separator:a8641c333b17b23422680a170900207c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb12c24e1c1eb162f2ecadc814d1238f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acb12c24e1c1eb162f2ecadc814d1238f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SafeWriter.html#acb12c24e1c1eb162f2ecadc814d1238f">flush</a> ()</td></tr>
<tr class="memdesc:acb12c24e1c1eb162f2ecadc814d1238f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush the given stream. It is recommended to prefer this call instead of <a class="el" href="classBeeeOn_1_1SafeWriter.html#a8641c333b17b23422680a170900207c7">stream()</a>.<a class="el" href="classBeeeOn_1_1SafeWriter.html#acb12c24e1c1eb162f2ecadc814d1238f" title="Flush the given stream. It is recommended to prefer this call instead of stream().flush() because the underlying stream implementation might not propagate flushing properly. ">flush()</a> because the underlying stream implementation might not propagate flushing properly. <br/></td></tr>
<tr class="separator:acb12c24e1c1eb162f2ecadc814d1238f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a870f97e6c98a4cffc06eed317bf7b241"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SafeWriter.html#a870f97e6c98a4cffc06eed317bf7b241">reset</a> ()</td></tr>
<tr class="memdesc:a870f97e6c98a4cffc06eed317bf7b241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the writer and allow to try writing again before commit succeeds.  <a href="#a870f97e6c98a4cffc06eed317bf7b241">More...</a><br/></td></tr>
<tr class="separator:a870f97e6c98a4cffc06eed317bf7b241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae135db0415126c31af290990e323ed43"><td class="memItemLeft" align="right" valign="top">std::pair<br class="typebreak"/>
&lt; Poco::DigestEngine::Digest, <br class="typebreak"/>
size_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SafeWriter.html#ae135db0415126c31af290990e323ed43">finalize</a> ()</td></tr>
<tr class="separator:ae135db0415126c31af290990e323ed43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af713b8d238a9fb8fe236fb3f05b27e5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SafeWriter.html#af713b8d238a9fb8fe236fb3f05b27e5f">commitAs</a> (const Poco::File &amp;targetFile)</td></tr>
<tr class="memdesc:af713b8d238a9fb8fe236fb3f05b27e5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Commit the prepared temporary file as follows:  <a href="#af713b8d238a9fb8fe236fb3f05b27e5f">More...</a><br/></td></tr>
<tr class="separator:af713b8d238a9fb8fe236fb3f05b27e5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a6d18d4bd495385c8593ae3685c87b24e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SafeWriter.html#a6d18d4bd495385c8593ae3685c87b24e">createLockFile</a> (bool force)</td></tr>
<tr class="memdesc:a6d18d4bd495385c8593ae3685c87b24e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the temporary lock file atomically. It fails in the case when the lock file already exists unless force is true. If the parameter force is true, then the already existing temporary lock file is first removed and then again recreated. We continue this process until we successfully create the temporary file atomically.  <a href="#a6d18d4bd495385c8593ae3685c87b24e">More...</a><br/></td></tr>
<tr class="separator:a6d18d4bd495385c8593ae3685c87b24e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classBeeeOn_1_1SafeWriter.html" title="SafeWriter is a helper that allows to perform file writes that are atomic. SafeWriter always rewrites...">SafeWriter</a> is a helper that allows to perform file writes that are atomic. <a class="el" href="classBeeeOn_1_1SafeWriter.html" title="SafeWriter is a helper that allows to perform file writes that are atomic. SafeWriter always rewrites...">SafeWriter</a> always rewrites a whole file. However, it either rewrites that file or it does nothing. </p>
<p>The actual writes are performed into a temporary file first. If writing fails. the file is simply removed. If writing succeeds, the <a class="el" href="classBeeeOn_1_1SafeWriter.html" title="SafeWriter is a helper that allows to perform file writes that are atomic. SafeWriter always rewrites...">SafeWriter</a> checks it for consistency (via SHA-1 checksum) and if the stored file's checksum is correct, it renames the temporary file to the target file (this should be atomic operation on most operating systems). </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="af713b8d238a9fb8fe236fb3f05b27e5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SafeWriter::commitAs </td>
          <td>(</td>
          <td class="paramtype">const Poco::File &amp;&#160;</td>
          <td class="paramname"><em>targetFile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Commit the prepared temporary file as follows: </p>
<ul>
<li>flush the underlying output stream</li>
<li>read back the temporary file and validate checksum of read-back data</li>
<li>rename the temporary lock file to the target destination </li>
</ul>

</div>
</div>
<a class="anchor" id="a6d18d4bd495385c8593ae3685c87b24e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SafeWriter::createLockFile </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create the temporary lock file atomically. It fails in the case when the lock file already exists unless force is true. If the parameter force is true, then the already existing temporary lock file is first removed and then again recreated. We continue this process until we successfully create the temporary file atomically. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">FileExistsException</td><td>when the lock file already exists </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae135db0415126c31af290990e323ed43"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; DigestEngine::Digest, size_t &gt; SafeWriter::finalize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Finalize writing into the underlying stream. This is not a commit but no more writes are possible after this call.</p>
<dl class="section return"><dt>Returns</dt><dd>digest and size of the written data </dd></dl>

</div>
</div>
<a class="anchor" id="a870f97e6c98a4cffc06eed317bf7b241"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SafeWriter::reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the writer and allow to try writing again before commit succeeds. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">IllegalStateException</td><td>if already committed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8641c333b17b23422680a170900207c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ostream &amp; SafeWriter::stream </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force</em> = <code>false</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>the underlying output stream unless already committed </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::IllegalStateException</td><td>in the case when the writter has already been committed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/var/lib/jenkins/workspace/beeeon-gateway-master/base/src/io/<a class="el" href="SafeWriter_8h_source.html">SafeWriter.h</a></li>
<li>/var/lib/jenkins/workspace/beeeon-gateway-master/base/src/io/SafeWriter.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
