<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>BeeeOn Gateway: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BeeeOn.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">BeeeOn Gateway
   &#160;<span id="projectnumber">v2018.07.1-70-g5436da6</span>
   </div>
   <div id="projectbrief">Platform to interconnect the IoT world</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BeeeOn Gateway is a software platform for integrating IoT technologies from different vendors. It abstracts from the sensoric network specifics and provides a unified interface to control sensors and actuator devices.</p>
<p>The BeeeOn Gateway is written in C++ and is divided into several components, especially:</p>
<ul>
<li>DeviceManager - a concept (usually a class) that implements specifics for a certain sensoric network. E.g. a single DeviceManager implementation manages all Z-Wave devices.</li>
<li>Distributor - a component that allows to distribute collected sensor data to a number of Exporters.</li>
<li>Exporter - a component that delivers sensor data to some collection point. The collection point can be MQTT, some cloud service, Unix Pipe, etc.</li>
<li>CommandDispatcher - a component that distributes commands into the BeeeOn Gateway. A class that implements the CommandHandler interface can be registered with the CommandDispatcher to be able to handle incoming commands. Commands are usually inserted into the BeeeOn Gateway from a remote control server.</li>
</ul>
<h2>Quick start</h2>
<p>The BeeeOn Gateway is built by the CMake build system:</p>
<p>``` $ mkdir build $ (cd build &amp;&amp; cmake ..) $ make -C build ```</p>
<p>During development, the BeeeOn Gateway can be started as:</p>
<p>``` $ build/src/beeeon-gateway -c conf/gateway-startup.ini ```</p>
<p>The executable <code>beeeon-gateway</code> reads the given configuration file and configuration files from conf/config.d. Then, the definition of the <em>main</em> instance (of class LoopRunner) is searched, created and executed. Then, all main application threads start.</p>
<h2>Hacking the BeeeOn Gateway</h2>
<p>In the following sections, you can find some tips how to work with the BeeeOn Gateway or how to customize it.</p>
<h3>Server-less debugging (TestingCenter)</h3>
<p>The BeeeOn Gateway is primarily intended to be controlled from a remote server. The server allows its users to communicate with gateways and their sensors. However, for development, it is uncomfortable to always work with a server. For this purpose, there is an internal debugging component named TestingCenter.</p>
<p>The TestingCenter is disabled as default. It must be enabled explicitly:</p>
<p>``` $ beeeon-gateway -c conf/gateway-startup -Dtesting.center.enable=yes ... <a class="el" href="classBeeeOn_1_1TestingCenter.html">BeeeOn::TestingCenter</a> 20:46:34.627 7052 [Critical] TESTING CENTER IS NOT INTENDED FOR PRODUCTION <a class="el" href="classBeeeOn_1_1TCPConsole.html">BeeeOn::TCPConsole</a> 20:46:34.627 7052 [Information] waiting for connection... ... ```</p>
<p>During startup, it will inform you that the TestingCenter is listening for TCP connections. The default port is 6000. Use some TCP line oriented tool (e.g. telnet, netcat) to connect and get the prompt:</p>
<p>``` $ nc localhost 6000 </p>
<blockquote class="doxtable">
<p>help</p>
<p></p>
</blockquote>
<p>Gateway Testing Center Commands: help - print this help exit - exit the console session command - dispatch a command into the system credentials - manage credentials storage device - simulate device in server database echo - echo arguments to output separated by space wait-queue - wait for new command answers ```</p>
<p>The TestingCenter allows to see some internals of the BeeeOn Gateway runtime. It provides a very basic help. The most important feature of the TestingCenter is the possibility to mimic the server. It allows to dispatch commands to the particular connected devices and receive results.</p>
<h3>Pairing a device via TestingCenter</h3>
<p>The BeeeOn Gateway implements the pairing process used in the BeeeOn system. The pairing process is used for all technologies regardless of their own pairing mechanisms. Some technologies may require a manual intervention with the particular devices (Jablotron, Z-Wave).</p>
<p>Pairing has always the two steps:</p>
<ol type="1">
<li>Discover new devices (listen).</li>
<li>Confirm devices to be paired (accept).</li>
</ol>
<p>To pair a device using the TestingCenter, type the following commands into the TestingCenter prompt:</p>
<p>``` </p>
<blockquote class="doxtable">
<p>command listen 30</p>
<p></p>
</blockquote>
<p>0x7F3CB0002030 PENDING 0/3 </p>
<blockquote class="doxtable">
<p>wait-queue</p>
<p></p>
</blockquote>
<p>0x7F3CB0002030 DONE 3/3 SSS </p>
<blockquote class="doxtable">
<p>device list-new</p>
<p></p>
</blockquote>
<p>0xa300000000000003 </p>
<blockquote class="doxtable">
<p>command device-accept 0xa300000000000003</p>
<p></p>
</blockquote>
<p>0x7F3CB0002CD0 PENDING 0/1 </p>
<blockquote class="doxtable">
<p>wait-queue</p>
<p></p>
</blockquote>
<p>0x7F3CB0002CD0 DONE 1/1 S ```</p>
<p>First, the <em>listen</em> command has discovered there is a single available device with ID <code>0xa300000000000003</code>. Note, that there were 3 Device Managers handling the <em>listen</em> command. Then, we accepted the device by sending <em>accept</em> command and waiting for the result. This time, only one Device Manager has responded.</p>
<p>A paired device would ship its measured sensor data to the Distributor component that would export it to the configured Exporters.</p>
<h3>Device Manager</h3>
<p>Each supported technology (Jablotron, Z-Wave, ...) is represented by a Device Manager. A Device Manager is usually a singleton class created once on startup. Its purpose is to translate the BeeeOn common interfaces to the specifics of the target technology. Each Device Manager is basically a thread (but no necessarily). It reacts to certain commands dispatched by the component CommandDispatcher. All such commands are asynchronous and can report the status of execution multiple times until finished. A Device Manager also ensures that the data delivered from the paired sensors are shipped into the Distributor component (and then exported out). Device Managers can also report technology-specific events via custom interfaces.</p>
<h3>Configuration</h3>
<p>The BeeeOn Gateway is configured at 2 levels of abstraction:</p>
<ol type="1">
<li>user level - mostly INI files</li>
<li>developer level - INI and XML files</li>
</ol>
<p>The <em>user level</em> configuration can be found in the <code>conf/gateway-startup.ini</code>. To configure virtual sensors, see also <code>conf/virtual-devices.ini</code>.</p>
<p>The <em>developer level</em> configuration is made by files located in the <code>conf/config.d</code> directory. Those files are loaded automatically during startup and define how to startup the whole system. The main component that is created and build is called <em>main</em> and it is defined in the <code>conf/config.d/factory.xml</code> file. It denotes an instance of the LoopRunner class. Its purpose is to start all main application threads (internally called loops).</p>
<h4>User level configuration</h4>
<p>The <em>user level</em> configuration is divided into several sections according to the number of subsystems in the BeeeOn Gateway.</p>
<h5>Core configuration entries</h5>
<ul>
<li>ssl.certificate.filePath - path to the SSL certificate used to identify the BeeeOn Gateway when connecting to the BeeeOn Server. Each BeeeOn Gateway should have a unique certificate signed by the BeeeOn Server authority.</li>
<li>ssl.privateKey.filePath - path to the SSL private key.</li>
<li>gateway.id - ID of the BeeeOn Gateway intended for <em>testing only</em>. In production, the ID is extracted from the SSL certificate.</li>
<li>application.instance.id - name of the application used for checking whether only one BeeeOn Gateway appliacation instance is currently running</li>
<li>application.instance.mode - (fail, ignore, recover) strategy to be used when dealing with multiple BeeeOn Gateway appliacation instances running</li>
</ul>
<h5>Credentials storage facility</h5>
<p>The BeeeOn Gateway provides a credentials storage facility. Its purpose is to serve credentials to Device Managers to authenticate with its sensors properly. The credentials storage can persist the credentials with a certain level of security. The current implementation stores all credentials in an encrypted form.</p>
<ul>
<li>credentials.file - encrypted file where to persist credentials</li>
<li>credentials.configuration.root - name of the configuration root element</li>
<li>credentials.save.delay - persisting of the dirty credentials cache is not done immediately, instead, it waits for the given amount of seconds</li>
<li>credentials.crypto.passphrase - secret passphrase intended for encryption; this should be unique for each BeeeOn Gateway</li>
<li>credentials.crypto.algorithm - algorithm used for credentials encryption</li>
</ul>
<h5>TestingCenter configuration</h5>
<ul>
<li>testing.center.enable - enable or disable starting of the TestingCenter on startup</li>
<li>testing.center.address - address to listen on for new connections (should be localhost)</li>
<li>testing.center.port - port to listen on for new connections</li>
</ul>
<h5>Gateway Server connection</h5>
<p>The GWServerConnector is a component of the BeeeOn Gateway. It provides connection to the remote server that allows users to control the BeeeOn Gateway and the connected devices.</p>
<ul>
<li>host - host machine (either IP address or domain name) where BeeeOn Server is supposed to run.</li>
<li>port - destination port of host for incoming connections</li>
<li>pollTimeout - timeout for polling network socket</li>
<li>receiveTimeout - timeout for receiving messages</li>
<li>sendTimeout - timeout for sending messages</li>
<li>retryConnectionTimeout - Specify how long should gateway wait before retrying in case of failed connection</li>
<li>maxMessageSize - specify maximum size (in bytes) of messages accepted by gateway application</li>
</ul>
<h5>Hotplug configuration</h5>
<p>Some Device Managers depend on external hardware - USB dongles. To detect that a dongle is present or disconnected, a hotplug mechanism is used. The preferred hotplug implementation is the udev (via UDevMonitor). However, there is also the PipeHotplugMonitor, the second hotplug interface that is controlled via a named pipe from some external sources.</p>
<ul>
<li>hotplug.pipe.path - path to the named pipe when the pipeHotplug implementation is used</li>
<li>hotplug.impl - name of the hotplug mechanism to use (available: udev, pipeHotplug)</li>
</ul>
<h5>Exporters configuration</h5>
<ul>
<li>exporter.pipe.enable - enable the NamedPipeExporter to be registered with the Distributor</li>
<li>exporter.pipe.path - path to the named pipe file to be used (created if not exists)</li>
<li>exporter.pipe.format - output format (available: CSV, JSON)</li>
<li>exporter.mqtt.enable - enable the MosquittoExporter to be registered with the Distributor</li>
<li>exporter.mqtt.host - host where the MQTT broker is running</li>
<li>exporter.mqtt.port - port where the MQTT broker is running</li>
<li>exporter.mqtt.topic - name of topic where to advertise data</li>
<li>exporter.mqtt.qos - MQTT QoS specification</li>
<li>exporter.mqtt.clientName - name of the MQTT client</li>
<li>exporter.mqtt.format - output format (available: CSV, JSON)</li>
</ul>
<h5>Belkin Wemo</h5>
<p>The BeeeOn Gateway application is currently not capable of the initial setup of Belkin Wemo devices. This must be done via the official procedure usign the WeMo mobile application. After the initial setup, we have full control over all currently supported devices.</p>
<ul>
<li>belkinwemo.enable - enable the Belkin Wemo support</li>
<li>belkinwemo.upnp.timeout - timeout of the UPnP lookup</li>
<li>belkinwemo.http.timeout - timeout of HTTP requests</li>
<li>belkinwemo.refresh - interval of polling the particular Belkin Wemo devices (seconds)</li>
</ul>
<h5>Bluetooth HCI statistics reporting</h5>
<p>The BeeeOn Gateway can periodically report statistics of HCI interfaces via the internal C++ interface HciListener.</p>
<ul>
<li>bluetooth.reporting.enable - enable reporting of HCI statistics</li>
<li>bluetooth.statistics.interval - interval of periodic reports of each HCI interface</li>
</ul>
<h5>Bluetooth availability</h5>
<p>The BeeeOn Gateway can scan the Bluetooth for availability of devices. When a device is available or unavailable, such event is distributed.</p>
<ul>
<li>bluetooth.availability.enable - enable the Bluetooth availability support</li>
<li>bluetooth.availability.modes - list of bluetooth modes to enable (available: classic, le)</li>
<li>bluetooth.availability.refresh - interval of scanning the network and reporting results</li>
<li>bluetooth.le.scanTime - time for a single LE scan when testing device availability</li>
</ul>
<h5>Jablotron</h5>
<ul>
<li>jablotron.enable - enable the Jablotron support</li>
<li>jablotron.unpairErasesSlot - enable erasing slots while doing unpair</li>
<li>jablotron.eraseAllOnProbe - when Turris Dongle is connected, all its slots would be erased</li>
<li>jablotron.registerOnProbe - when Turris Dongle is connected, the given list of addresses is registered</li>
</ul>
<h5>Virtual devices</h5>
<p>For debugging and testing purposes, the BeeeOn Gateway contains a subsystem for creating virtual devices. Virtual devices are configured once before startup. Then they mimic real sensors or actuators.</p>
<ul>
<li>vdev.enable - enable the Virtual devices support</li>
<li>vdev.ini - path to INI file with definitions of particular virtual devices to create on startup</li>
</ul>
<h5>Z-Wave</h5>
<ul>
<li>zwave.enable - enable the Z-Wave support</li>
<li>zwave.ozw.userPath - path to OpenZWave user config data and state</li>
<li>zwave.ozw.configPath - path to OpenZWave XML config data</li>
<li>zwave.ozw.pollInterval - polling interval to be used with older devices (via OpenZWave)</li>
<li>zwave.statistics.interval - interval of reporting statistics of the Z-Wave network</li>
<li>zwave.controllers.reset - comma-separated list of home IDs of controllers to be reset once connected</li>
</ul>
<h4>Thermona VPT</h4>
<ul>
<li>vpt.refresh - polling frequency of managed VPT devices (e.g. "20 s")</li>
<li>netif.blacklist - which network interfaces should not be scanned for new devices (allows glob patterns like "eth?", "tap[01]")</li>
<li>min.net.mask - specify the sub-network for scanning new devices (e.g. 255.255.255.0)</li>
</ul>
<h4>Air Pressure Sensor</h4>
<p>Settings for the internal Air Pressure Sensor that is available on the original BeeeOn Gateway board. It can however be used for any pressure sensor available via sysfs.</p>
<ul>
<li>psdev.path - specify path (typically in sysfs), where data can be accessed (e.g. /sys/devices/platform/soc@01c00000/1c2b400.i2c/i2c-2/2-0077/pressure0_input)</li>
</ul>
<h5>Philips Hue</h5>
<ul>
<li>philipshue.enable - enable the Philips Hue support</li>
<li>philipshue.upnp.timeout - timeout of the UPnP lookup</li>
<li>philipshue.http.timeout - timeout of HTTP requests</li>
<li>philipshue.refresh - interval of polling the particular Philips Hue devices (seconds)</li>
</ul>
<h5>BLE Smart</h5>
<ul>
<li>blesmart.enable - enable the BLE Smart support</li>
<li>bluetooth.le.scanTimeout - timeout of the Bluetooth Low Energy scan</li>
<li>blesmart.device.timeout - timeout of work with the device (connect, wait to load services, read/write request)</li>
<li>blesmart.refresh - interval of polling the particular BLE Smart devices (seconds) </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
