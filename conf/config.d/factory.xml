<system>
	<factory>
		<instance name="main" class="BeeeOn::LoopRunner">
			<add name="runnables" ref="belkinwemoDeviceManager" if-yes="${belkinwemo.enable}" />
			<add name="runnables" ref="bluetoothAvailability" if-yes="${bluetooth.enable}" />
			<add name="runnables" ref="virtualSensor1" if-yes="${virtual-sensor1.enable}" />
			<add name="runnables" ref="virtualSensor2" if-yes="${virtual-sensor2.enable}" />
			<add name="runnables" ref="virtualSensor3" if-yes="${virtual-sensor3.enable}" />
			<add name="runnables" ref="testingCenter" if-yes="${testing.center.enable}" />
			<add name="runnables" ref="udevMonitor" />
			<add name="runnables" ref="jablotronDeviceManager" if-yes="${jablotron.enable}" />
			<add name="runnables" ref="virtualDeviceManager" if-yes="${vdev.enable}" />
		</instance>

		<instance name="gatewayInfo" class="BeeeOn::GatewayInfo" init="early">
			<set name="certificatePath" text="${ssl.certificate.filePath}" />
			<set name="keyPath" text="${ssl.privateKey.filePath}" />
			<set name="gatewayID" text="${gateway.id}" />
		</instance>

		<instance name="distributor" class="BeeeOn::BasicDistributor">
			<set name="exporter" ref="namedPipeExporter" if-yes="${exporter.pipe.enable}"/>
			<set name="exporter" ref="mosquittoExporter" if-yes="${exporter.mqtt.enable}"/>
			<set name="executor" ref="asyncExecutor"/>
		</instance>

		<instance name="asyncExecutor" class="BeeeOn::AsyncExecutor">
		</instance>

		<instance name="commandDispatcher" class="BeeeOn::PocoCommandDispatcher">
			<set name="registerHandler" ref="testingCenter" if-yes="${testing.center.enable}"/>
			<set name="registerHandler" ref="belkinwemoDeviceManager" if-yes="${belkinwemo.enable}"/>
			<add name="registerHandler" ref="bluetoothAvailability" if-yes="${bluetooth.enable}" />
			<set name="registerHandler" ref="jablotronDeviceManager" if-yes="${jablotron.enable}"/>
			<set name="registerHandler" ref="virtualDeviceManager" if-yes="${vdev.enable}"/>
		</instance>

		<instance name="udevMonitor" class="BeeeOn::UDevMonitor">
			<set name="matches" list="bluetooth,tty" />
			<add name="listeners" ref="bluetoothAvailability" if-yes="${bluetooth.enable}" />
			<set name="listeners" ref="jablotronDeviceManager" if-yes="${jablotron.enable}"/>
		</instance>

		<instance name="belkinwemoDeviceManager" class="BeeeOn::BelkinWemoDeviceManager">
			<set name="httpTimeout" number="${belkinwemo.http.timeout}" />
			<set name="upnpTimeout" number="${belkinwemo.upnp.timeout}" />
			<set name="refresh" number="${belkinwemo.refresh}" />
			<set name="distributor" ref="distributor" />
			<set name="commandDispatcher" ref="commandDispatcher" />
		</instance>

		<instance name="virtualDeviceManager" class="BeeeOn::VirtualDeviceManager">
			<set name="distributor" ref="distributor"/>
			<set name="commandDispatcher" ref="commandDispatcher"/>
			<set name="file" text="${vdev.ini}"/>
		</instance>

		<instance name="bluetoothAvailability" class="BeeeOn::BluetoothAvailabilityManager">
			<set name="wakeUpTime" number="${bluetooth.refresh.time}" />
			<set name="distributor" ref="distributor" />
			<set name="commandDispatcher" ref="commandDispatcher" />
		</instance>

		<instance name="virtualSensor1" class="BeeeOn::VirtualSensor">
			<set name="refresh" number="${virtual-sensor1.refresh}" />
			<set name="min" number="${virtual-sensor1.min}" />
			<set name="max" number="${virtual-sensor1.max}" />
			<set name="deviceId" text="${virtual-sensor1.deviceId}" />
			<set name="distributor" ref="distributor"/>
		</instance>

		<instance name="virtualSensor2" class="BeeeOn::VirtualSensor">
			<set name="refresh" number="${virtual-sensor2.refresh}" />
			<set name="min" number="${virtual-sensor2.min}" />
			<set name="max" number="${virtual-sensor2.max}" />
			<set name="deviceId" text="${virtual-sensor2.deviceId}" />
			<set name="distributor" ref="distributor"/>
		</instance>

		<instance name="virtualSensor3" class="BeeeOn::VirtualSensor">
			<set name="refresh" number="${virtual-sensor3.refresh}" />
			<set name="min" number="${virtual-sensor3.min}" />
			<set name="max" number="${virtual-sensor3.max}" />
			<set name="deviceId" text="${virtual-sensor3.deviceId}" />
			<set name="distributor" ref="distributor"/>
		</instance>

		<instance name="testingConsole" class="BeeeOn::TCPConsole">
			<set name="address" text="${testing.center.tcp.address}" />
			<set name="port" number="${testing.center.tcp.port}" />
			<set name="recvTimeout" number="0" />
		</instance>

		<instance name="testingCenter" class="BeeeOn::TestingCenter">
			<set name="commandDispatcher" ref="commandDispatcher" />
			<set name="console" ref="testingConsole" />
			<set name="credentialsStorage" ref="credentialsStorage" />
			<set name="cryptoConfig" ref="cryptoConfig" />
		</instance>

		<instance name="credentialsStorage" class="BeeeOn::FileCredentialsStorage" init="early">
			<set name="file" text="${credentials.file}" />
			<set name="configurationRoot" text="${credentials.configuration.root}" />
			<set name="saveDelayTime" number="${credentials.save.delay}" />
		</instance>

		<instance name="cryptoConfig" class="BeeeOn::CryptoConfig">
			<set name="passphrase" text="${credentials.crypto.passphrase}" />
			<set name="algorithm" text="${credentials.crypto.algorithm}" />
		</instance>

		<instance name="jablotronDeviceManager" class="BeeeOn::JablotronDeviceManager">
			<set name="distributor" ref="distributor" />
			<set name="commandDispatcher" ref="commandDispatcher" />
		</instance>

		<instance name="zwaveDeviceInfoRegistry" class="BeeeOn::GenericZWaveDeviceInfoRegistry">
		</instance>
	</factory>
</system>
