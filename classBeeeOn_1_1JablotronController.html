<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>BeeeOn Gateway: BeeeOn::JablotronController Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BeeeOn.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">BeeeOn Gateway
   &#160;<span id="projectnumber">v2019.9.1-10-gaa1a876</span>
   </div>
   <div id="projectbrief">Platform to interconnect the IoT world</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>BeeeOn</b></li><li class="navelem"><a class="el" href="classBeeeOn_1_1JablotronController.html">JablotronController</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">BeeeOn::JablotronController Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classBeeeOn_1_1JablotronController.html" title="JablotronController provides access to the Turris Dongle that is connected via a serial port...">JablotronController</a> provides access to the Turris Dongle that is connected via a serial port. The Turris Dongle must be probed to start an internal I/O thread that handles incoming messages.  
 <a href="classBeeeOn_1_1JablotronController.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="JablotronController_8h_source.html">JablotronController.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for BeeeOn::JablotronController:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classBeeeOn_1_1JablotronController.png" usemap="#BeeeOn::JablotronController_map" alt=""/>
  <map id="BeeeOn::JablotronController_map" name="BeeeOn::JablotronController_map">
<area href="classBeeeOn_1_1Loggable.html" alt="BeeeOn::Loggable" shape="rect" coords="0,0,173,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:aac92a2d620706fd4ded553b7a8610899"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><b>Beep</b> { <b>BEEP_NONE</b>, 
<b>BEEP_SLOW</b>, 
<b>BEEP_FAST</b>
 }</td></tr>
<tr class="separator:aac92a2d620706fd4ded553b7a8610899"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa23ae003e0ae65728354b84b4216acc8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa23ae003e0ae65728354b84b4216acc8"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#aa23ae003e0ae65728354b84b4216acc8">setMaxProbeAttempts</a> (int count)</td></tr>
<tr class="memdesc:aa23ae003e0ae65728354b84b4216acc8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure number of attempts to initiate communication with the serial port connected to a Turris Dongle. <br/></td></tr>
<tr class="separator:aa23ae003e0ae65728354b84b4216acc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a594b6b8ff149b7e2d924664006d0b808"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a594b6b8ff149b7e2d924664006d0b808"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a594b6b8ff149b7e2d924664006d0b808">setProbeTimeout</a> (const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:a594b6b8ff149b7e2d924664006d0b808"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure timeout to wait for response from Turris Dongle while probing it. <br/></td></tr>
<tr class="separator:a594b6b8ff149b7e2d924664006d0b808"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f67c03cced638541a3c6036cb037813"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1f67c03cced638541a3c6036cb037813"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a1f67c03cced638541a3c6036cb037813">setIOJoinTimeout</a> (const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:a1f67c03cced638541a3c6036cb037813"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure join timeout when waiting for the I/O thread to finish. <br/></td></tr>
<tr class="separator:a1f67c03cced638541a3c6036cb037813"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac02a1143a8ab8d09d1a258c5cf431500"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac02a1143a8ab8d09d1a258c5cf431500"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ac02a1143a8ab8d09d1a258c5cf431500">setIOReadTimeout</a> (const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:ac02a1143a8ab8d09d1a258c5cf431500"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure timeout to use while reading from the serial port inside the I/O loop. The value can be negative but in such case, it might not be woken up properly on exit. <br/></td></tr>
<tr class="separator:ac02a1143a8ab8d09d1a258c5cf431500"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43d2fa833317f2ce1373b83326e37575"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a43d2fa833317f2ce1373b83326e37575"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a43d2fa833317f2ce1373b83326e37575">setIOErrorSleep</a> (const Poco::Timespan &amp;delay)</td></tr>
<tr class="memdesc:a43d2fa833317f2ce1373b83326e37575"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set time interval to sleep for when there is an I/O error. It reduces the number of logged error messages and avoids making the CPU overloaded in such case. <br/></td></tr>
<tr class="separator:a43d2fa833317f2ce1373b83326e37575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a754ab9049a184fe535e4160c67aea340"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a754ab9049a184fe535e4160c67aea340">probe</a> (const std::string &amp;dev)</td></tr>
<tr class="memdesc:a754ab9049a184fe535e4160c67aea340"><td class="mdescLeft">&#160;</td><td class="mdescRight">Probe the given serial port (e.g. "/dev/ttyUSB0") and if it proves to be a Jablotron control station, the internal I/O thread is started. Only 1 I/O thread can run at a time and only 1 central can be served by an instance of this class.  <a href="#a754ab9049a184fe535e4160c67aea340">More...</a><br/></td></tr>
<tr class="separator:a754ab9049a184fe535e4160c67aea340"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad11b8c5ac3aff27ab784388e44e47d09"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad11b8c5ac3aff27ab784388e44e47d09"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ad11b8c5ac3aff27ab784388e44e47d09">release</a> (const std::string &amp;dev)</td></tr>
<tr class="memdesc:ad11b8c5ac3aff27ab784388e44e47d09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release the serial port and stop the I/O thread if running. If the argument dev does not match the current serial port, nothing happens. <br/></td></tr>
<tr class="separator:ad11b8c5ac3aff27ab784388e44e47d09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ef558831595452597aad5aeb489c022"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ef558831595452597aad5aeb489c022"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a2ef558831595452597aad5aeb489c022">dispose</a> ()</td></tr>
<tr class="memdesc:a2ef558831595452597aad5aeb489c022"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release the serial port and stop the I/O thread if running. <br/></td></tr>
<tr class="separator:a2ef558831595452597aad5aeb489c022"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93bfa5d5aa4387fe72cca53c2df96a5e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a93bfa5d5aa4387fe72cca53c2df96a5e"></a>
<a class="el" href="structBeeeOn_1_1JablotronReport.html">JablotronReport</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a93bfa5d5aa4387fe72cca53c2df96a5e">pollReport</a> (const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:a93bfa5d5aa4387fe72cca53c2df96a5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Poll for reports coming from Jablotron sensors. If the timeout exceeds, an invalid report is returned. The timeout can be -1 to denote infinite waiting. <br/></td></tr>
<tr class="separator:a93bfa5d5aa4387fe72cca53c2df96a5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e26d6740aee9ac82566912107685228"><td class="memItemLeft" align="right" valign="top">Poco::Nullable&lt; uint32_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a0e26d6740aee9ac82566912107685228">readSlot</a> (unsigned int i, const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:a0e26d6740aee9ac82566912107685228"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read address of the given slot.  <a href="#a0e26d6740aee9ac82566912107685228">More...</a><br/></td></tr>
<tr class="separator:a0e26d6740aee9ac82566912107685228"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3be090f0431bef5ebf7104b3027548b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a3be090f0431bef5ebf7104b3027548b9">registerSlot</a> (unsigned int i, uint32_t address, const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:a3be090f0431bef5ebf7104b3027548b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register the given slot with the given address.  <a href="#a3be090f0431bef5ebf7104b3027548b9">More...</a><br/></td></tr>
<tr class="separator:a3be090f0431bef5ebf7104b3027548b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae91efad5e0fc63c4d75f59d57435ae92"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ae91efad5e0fc63c4d75f59d57435ae92">unregisterSlot</a> (unsigned int i, const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:ae91efad5e0fc63c4d75f59d57435ae92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unregister the given slot.  <a href="#ae91efad5e0fc63c4d75f59d57435ae92">More...</a><br/></td></tr>
<tr class="separator:ae91efad5e0fc63c4d75f59d57435ae92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fcbd8ecd12f857f75af7cd34e675113"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a9fcbd8ecd12f857f75af7cd34e675113">eraseSlots</a> (const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:a9fcbd8ecd12f857f75af7cd34e675113"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unregister all slots at once.  <a href="#a9fcbd8ecd12f857f75af7cd34e675113">More...</a><br/></td></tr>
<tr class="separator:a9fcbd8ecd12f857f75af7cd34e675113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4084567ac9f33849e943a0fcbfe736e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ad4084567ac9f33849e943a0fcbfe736e">sendTX</a> (bool x, bool y, bool alarm, Beep beep, const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:ad4084567ac9f33849e943a0fcbfe736e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send status packet with PGX and PGY set to either 1 or 0 accodring to the given values. Alarm is disabled and beeping set to <code>FAST</code>.  <a href="#ad4084567ac9f33849e943a0fcbfe736e">More...</a><br/></td></tr>
<tr class="separator:ad4084567ac9f33849e943a0fcbfe736e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac75763de6618afd15b52cd05ea208c5b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ac75763de6618afd15b52cd05ea208c5b">sendEnroll</a> (const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:ac75763de6618afd15b52cd05ea208c5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send enroll packet with PGX, PGY and ALARM as 0 and no beeping.  <a href="#ac75763de6618afd15b52cd05ea208c5b">More...</a><br/></td></tr>
<tr class="separator:ac75763de6618afd15b52cd05ea208c5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a7ceb80ac15cf59366ac1bf4d9306190a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a7ceb80ac15cf59366ac1bf4d9306190a">handleOkError</a> (const std::string &amp;response) const </td></tr>
<tr class="memdesc:a7ceb80ac15cf59366ac1bf4d9306190a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the response is "OK" or "ERROR".  <a href="#a7ceb80ac15cf59366ac1bf4d9306190a">More...</a><br/></td></tr>
<tr class="separator:a7ceb80ac15cf59366ac1bf4d9306190a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a238803f4b31670543ac59768b23c4129"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a238803f4b31670543ac59768b23c4129">command</a> (const std::string &amp;request, const Poco::Timespan &amp;timeout)</td></tr>
<tr class="memdesc:a238803f4b31670543ac59768b23c4129"><td class="mdescLeft">&#160;</td><td class="mdescRight">Issue a command and return its result unless the timeout exceeds.  <a href="#a238803f4b31670543ac59768b23c4129">More...</a><br/></td></tr>
<tr class="separator:a238803f4b31670543ac59768b23c4129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95cb6d5b53a8bc1c6ceb9845ed97f0c7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a95cb6d5b53a8bc1c6ceb9845ed97f0c7"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a95cb6d5b53a8bc1c6ceb9845ed97f0c7">startIO</a> ()</td></tr>
<tr class="memdesc:a95cb6d5b53a8bc1c6ceb9845ed97f0c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the I/O thread without any checks and clear any thread-related status. <br/></td></tr>
<tr class="separator:a95cb6d5b53a8bc1c6ceb9845ed97f0c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad53753561b97e46725c0bf53c81acc1d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad53753561b97e46725c0bf53c81acc1d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ad53753561b97e46725c0bf53c81acc1d">stopIO</a> (const std::string &amp;dev)</td></tr>
<tr class="memdesc:ad53753561b97e46725c0bf53c81acc1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the I/O thread is any and if the argument dev matches the currently used serial port. The call blocks until the I/O threads finishes or the ioJoinTimeout exceeds. <br/></td></tr>
<tr class="separator:ad53753561b97e46725c0bf53c81acc1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a858b2d35b99354d997eec782d2b7a480"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a858b2d35b99354d997eec782d2b7a480"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a858b2d35b99354d997eec782d2b7a480">probePort</a> (const std::string &amp;dev)</td></tr>
<tr class="memdesc:a858b2d35b99354d997eec782d2b7a480"><td class="mdescLeft">&#160;</td><td class="mdescRight">Probe the given port and test whether it is an appropriate Turris Dongle. Any obsolete messages in the serial port's buffer (that are invalid) are discarded. <br/></td></tr>
<tr class="separator:a858b2d35b99354d997eec782d2b7a480"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a070d5fba8b75f9a2e2c9a15eed50b9aa"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a070d5fba8b75f9a2e2c9a15eed50b9aa">receivedVersion</a> (const std::string &amp;response)</td></tr>
<tr class="memdesc:a070d5fba8b75f9a2e2c9a15eed50b9aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the response to be the version string.  <a href="#a070d5fba8b75f9a2e2c9a15eed50b9aa">More...</a><br/></td></tr>
<tr class="separator:a070d5fba8b75f9a2e2c9a15eed50b9aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4967ecde9a5454cee94493aca88cb1e4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4967ecde9a5454cee94493aca88cb1e4"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a4967ecde9a5454cee94493aca88cb1e4">popResponse</a> ()</td></tr>
<tr class="memdesc:a4967ecde9a5454cee94493aca88cb1e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pop the most recent received response. All older responses are dropped because only 1 command can be issued at a time. All pending older responses are dropped as they are probably some past unhandled responses. <br/></td></tr>
<tr class="separator:a4967ecde9a5454cee94493aca88cb1e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade142ce52040158527a5fc7279e076af"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ade142ce52040158527a5fc7279e076af"></a>
<a class="el" href="structBeeeOn_1_1JablotronReport.html">JablotronReport</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ade142ce52040158527a5fc7279e076af">popReport</a> ()</td></tr>
<tr class="memdesc:ade142ce52040158527a5fc7279e076af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pop the oldest report from the associated queue. If the queue is empty, it returns an invalid report. <br/></td></tr>
<tr class="separator:ade142ce52040158527a5fc7279e076af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8ea61efa25e9e736ba7c061c153636f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#ab8ea61efa25e9e736ba7c061c153636f">readAndProcess</a> ()</td></tr>
<tr class="memdesc:ab8ea61efa25e9e736ba7c061c153636f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the serial port and process all received messages in order.  <a href="#ab8ea61efa25e9e736ba7c061c153636f">More...</a><br/></td></tr>
<tr class="separator:ab8ea61efa25e9e736ba7c061c153636f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a566ef4d6b603cd8da5554378760c512b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a566ef4d6b603cd8da5554378760c512b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a566ef4d6b603cd8da5554378760c512b">processMessage</a> (const std::string &amp;message)</td></tr>
<tr class="memdesc:a566ef4d6b603cd8da5554378760c512b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process the given message. The call recognizes 2 kinds of messages: reports from sensors and other (unknown) messages. The reports are appended into the m_reports queue and the m_pollEvent is signalzed. All non-report messages are appended into the m_responses queue and the m_requestEvent is signalized. <br/></td></tr>
<tr class="separator:a566ef4d6b603cd8da5554378760c512b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec994a49169a106cdf3223d007569be"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6ec994a49169a106cdf3223d007569be"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1JablotronController.html#a6ec994a49169a106cdf3223d007569be">ioLoop</a> ()</td></tr>
<tr class="memdesc:a6ec994a49169a106cdf3223d007569be"><td class="mdescLeft">&#160;</td><td class="mdescRight">The entry into the I/O thread loop. It periodically calls <a class="el" href="classBeeeOn_1_1JablotronController.html#ab8ea61efa25e9e736ba7c061c153636f" title="Read the serial port and process all received messages in order. ">readAndProcess()</a> and checks whether a stop is requested. Any time an IOException is caught, the loop sleeps for ioErrorSleep and tries again. Timeouts from serial port are ignored. <br/></td></tr>
<tr class="separator:a6ec994a49169a106cdf3223d007569be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afab2469234f4d008eb6141ceff8446d4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afab2469234f4d008eb6141ceff8446d4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>writePort</b> (const std::string &amp;request)</td></tr>
<tr class="separator:afab2469234f4d008eb6141ceff8446d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a569a25c71e28df1101eb76b03b3c3ca8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a569a25c71e28df1101eb76b03b3c3ca8"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><b>readPort</b> (const Poco::Timespan &amp;timeout)</td></tr>
<tr class="separator:a569a25c71e28df1101eb76b03b3c3ca8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classBeeeOn_1_1JablotronController.html" title="JablotronController provides access to the Turris Dongle that is connected via a serial port...">JablotronController</a> provides access to the Turris Dongle that is connected via a serial port. The Turris Dongle must be probed to start an internal I/O thread that handles incoming messages. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a238803f4b31670543ac59768b23c4129"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string JablotronController::command </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Issue a command and return its result unless the timeout exceeds. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::TimeoutException</td><td>- no response on time </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9fcbd8ecd12f857f75af7cd34e675113"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::eraseSlots </td>
          <td>(</td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unregister all slots at once. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::ProtocolException</td><td>when response is "ERROR" </td></tr>
    <tr><td class="paramname">Poco::IllegalStateException</td><td>when response is not "OK" nor "ERROR" </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7ceb80ac15cf59366ac1bf4d9306190a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::handleOkError </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check whether the response is "OK" or "ERROR". </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::ProtocolException</td><td>when response is "ERROR" </td></tr>
    <tr><td class="paramname">Poco::IllegalStateException</td><td>when response is not "OK" nor "ERROR" </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a754ab9049a184fe535e4160c67aea340"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::probe </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Probe the given serial port (e.g. "/dev/ttyUSB0") and if it proves to be a Jablotron control station, the internal I/O thread is started. Only 1 I/O thread can run at a time and only 1 central can be served by an instance of this class. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::IOException</td><td>in case of a communication failure (station is disconnected) </td></tr>
    <tr><td class="paramname">Poco::TimeoutException</td><td>is probe takes too long time (wrong device?) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab8ea61efa25e9e736ba7c061c153636f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::readAndProcess </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read the serial port and process all received messages in order. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::TimeoutException</td><td>is ioReadTimeout exceeds while reading from the serial port </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0e26d6740aee9ac82566912107685228"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Nullable&lt; uint32_t &gt; JablotronController::readSlot </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read address of the given slot. </p>
<dl class="section return"><dt>Returns</dt><dd>address of the device at the requested slot or null if not set. </dd></dl>

</div>
</div>
<a class="anchor" id="a070d5fba8b75f9a2e2c9a15eed50b9aa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool JablotronController::receivedVersion </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse the response to be the version string. </p>
<dl class="section return"><dt>Returns</dt><dd>true if the version string was recognized </dd></dl>

</div>
</div>
<a class="anchor" id="a3be090f0431bef5ebf7104b3027548b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::registerSlot </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register the given slot with the given address. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::ProtocolException</td><td>when response is "ERROR" </td></tr>
    <tr><td class="paramname">Poco::IllegalStateException</td><td>when response is not "OK" nor "ERROR" </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac75763de6618afd15b52cd05ea208c5b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::sendEnroll </td>
          <td>(</td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send enroll packet with PGX, PGY and ALARM as 0 and no beeping. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::ProtocolException</td><td>when response is "ERROR" </td></tr>
    <tr><td class="paramname">Poco::IllegalStateException</td><td>when response is not "OK" nor "ERROR" </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad4084567ac9f33849e943a0fcbfe736e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::sendTX </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>alarm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Beep&#160;</td>
          <td class="paramname"><em>beep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send status packet with PGX and PGY set to either 1 or 0 accodring to the given values. Alarm is disabled and beeping set to <code>FAST</code>. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::ProtocolException</td><td>when response is "ERROR" </td></tr>
    <tr><td class="paramname">Poco::IllegalStateException</td><td>when response is not "OK" nor "ERROR" </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae91efad5e0fc63c4d75f59d57435ae92"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JablotronController::unregisterSlot </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unregister the given slot. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Poco::ProtocolException</td><td>when response is "ERROR" </td></tr>
    <tr><td class="paramname">Poco::IllegalStateException</td><td>when response is not "OK" nor "ERROR" </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/var/lib/jenkins/workspace/beeeon-gateway-master/src/jablotron/<a class="el" href="JablotronController_8h_source.html">JablotronController.h</a></li>
<li>/var/lib/jenkins/workspace/beeeon-gateway-master/src/jablotron/JablotronController.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
